name: curl
version: "8.9.1"
description: "Command line tool and library for transferring data with URLs"
author: "Daniel Stenberg"
license: "curl"
homepage: "https://curl.se/"
repository: "https://github.com/curl/curl.git"
source_url: "https://curl.se/download/curl-8.9.1.tar.xz"
keywords:
  - curl
  - download
  - http
  - https
  - ftp
  - networking
categories:
  - packages
  - networking

dependencies:
  build_dependencies:
    - name: "gcc"
      version_constraint: ">=11"
      optional: false
    - name: "make"
      version_constraint: ">=4.3"
      optional: false
    - name: "automake"
      version_constraint: ">=1.16"
      optional: false
    - name: "cmake"
      version_constraint: ">=3.26"
      optional: false
    - name: "libtool"
      version_constraint: ">=2.4"
      optional: false
    - name: "pkgconf"
      version_constraint: ">=1.7"
      optional: false
    - name: "perl"
      version_constraint: ">=5.32"
      optional: false
    - name: "zlib-devel"
      version_constraint: ">=1.2"
      optional: false
    - name: "brotli-devel"
      version_constraint: ">=1.0"
      optional: false
    - name: "libidn2-devel"
      version_constraint: ">=2.3"
      optional: false
    - name: "libnghttp2-devel"
      version_constraint: ">=1.45"
      optional: false
    - name: "libpsl-devel"
      version_constraint: ">=0.21"
      optional: false
    - name: "libssh-devel"
      version_constraint: ">=0.10"
      optional: false
    - name: "krb5-devel"
      version_constraint: ">=1.20"
      optional: false
    - name: "openldap-devel"
      version_constraint: ">=2.6"
      optional: false
    - name: "openssl-devel"
      version_constraint: ">=3.0"
      optional: false
  runtime_dependencies:
    - {name: "glibc", version_constraint: null, optional: false}
    - {name: "openssl", version_constraint: null, optional: false}
    - {name: "zlib", version_constraint: null, optional: false}
    - {name: "libidn2", version_constraint: null, optional: false}
    - {name: "libnghttp2", version_constraint: null, optional: false}
    - {name: "libunistring", version_constraint: null, optional: false}

  optional_dependencies: []
  conflicts: []

build:
  build_system: Make
  build_commands:
    - |
      # Ensure we use the correct libnghttp2 version
      # Check if pkg-config can find libnghttp2 >= 1.61.0
      if pkg-config --exists 'libnghttp2 >= 1.61.0'; then
        NGHTTP2_PREFIX=$(pkg-config --variable=prefix libnghttp2 2>/dev/null || echo "/usr")
        PKG_CONFIG_PATH="${PKG_CONFIG_PATH:-}:/usr/lib/pkgconfig:/usr/lib64/pkgconfig:${NGHTTP2_PREFIX}/lib/pkgconfig:${NGHTTP2_PREFIX}/lib64/pkgconfig" \
        LDFLAGS="${LDFLAGS:-} -L${NGHTTP2_PREFIX}/lib64 -L${NGHTTP2_PREFIX}/lib -L/usr/lib64 -L/usr/lib" \
        CPPFLAGS="${CPPFLAGS:-} -I${NGHTTP2_PREFIX}/include -I/usr/include" \
        ./configure --prefix=/usr --with-openssl --with-zlib --with-nghttp2=${NGHTTP2_PREFIX}
      else
        # Fallback: try without nghttp2 if version is too old
        echo "Warning: libnghttp2 >= 1.61.0 not found, building without HTTP/2 support"
        ./configure --prefix=/usr --with-openssl --with-zlib --without-nghttp2
      fi
    - "make"
  build_dependencies:
    - "gcc"
    - "make"
    - "automake"
    - "cmake"
    - "libtool"
    - "pkgconf"
    - "perl"
    - "openssl-devel"
    - "zlib-devel"
    - "brotli-devel"
    - "libidn2-devel"
    - "libnghttp2-devel"
    - "libpsl-devel"
    - "libssh-devel"
    - "krb5-devel"
    - "openldap-devel"
  build_flags: []
  environment:
    CFLAGS: "-O2"
  working_directory: null
  target_architectures:
    - X86_64v1
    - X86_64v3
    - Aarch64
  cross_compiler_prefix: null
  target_sysroot: null

install:
  install_method: RunCommands
  install_commands:
    - "make install DESTDIR=$DESTDIR"
  install_directories:
    - "/usr/bin"
    - "/usr/lib"
    - "/usr/share/man"
    - "/usr/share/doc"
  install_files: []
  post_install_commands: []

files:
  include_patterns:
    - "*.c"
    - "*.h"
    - "configure"
    - "Makefile.in"
  exclude_patterns:
    - "**/*.o"
    - "**/*.a"
    - "tests/**/*"
    - ".git/**/*"
  binary_files:
    - "usr/bin/curl"
    - "usr/lib/libcurl.so*"
  config_files: []
  documentation_files: []
  license_files: []

scripts:
  pre_install: |
    echo "Installing curl..."
  post_install: |
    echo "curl installed successfully"
  pre_uninstall: |
    echo "Removing curl..."
  post_uninstall: |
    echo "curl removed successfully"
  pre_upgrade: null
  post_upgrade: null

metadata:
  maintainer: "Oreon Project Team <packaging@oreonproject.org>"
  section: "packages"
  priority: "optional"
  provides:
    - "curl"
  conflicts: []

