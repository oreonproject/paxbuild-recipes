name: gcc
version: "15.2.0"
description: "GNU Compiler Collection - C, C++, and other language compilers"
author: "GNU Project"
license: "GPL-3.0-or-later WITH GCC-exception-3.1"
homepage: "https://gcc.gnu.org/"
repository: "https://gcc.gnu.org/git/gcc.git"
source_url: "https://sourceware.org/pub/gcc/releases/gcc-15.2.0/gcc-15.2.0.tar.xz"
keywords: [gcc, compiler, c, c++, gnu]
categories: [development, system]

dependencies:
  build_dependencies:
    - {name: "gcc", version_constraint: ">=11", optional: false}
    - {name: "gcc-c++", version_constraint: ">=11", optional: false}
    - {name: "make", version_constraint: ">=4.3", optional: false}
    - {name: "gawk", version_constraint: ">=5.1", optional: false}
    - {name: "bison", version_constraint: ">=3.8", optional: false}
    - {name: "flex", version_constraint: ">=2.6", optional: false}
    - {name: "texinfo", version_constraint: ">=7.0", optional: false}
    - {name: "texinfo-tex", version_constraint: ">=7.0", optional: false}
    - {name: "gettext", version_constraint: ">=0.21", optional: false}
    - {name: "zlib-devel", version_constraint: ">=1.2", optional: false}
    - {name: "gmp-devel", version_constraint: ">=6.2", optional: false}
    - {name: "mpfr-devel", version_constraint: ">=4.2", optional: false}
    - {name: "libmpc-devel", version_constraint: ">=1.3", optional: false}
    - {name: "libzstd-devel", version_constraint: ">=1.5", optional: false}
    - {name: "libunwind-devel", version_constraint: ">=1.6", optional: false}
    - {name: "systemtap-sdt-devel", version_constraint: ">=1.3", optional: false}
    - {name: "elfutils-devel", version_constraint: ">=0.188", optional: false}
    - {name: "elfutils-libelf-devel", version_constraint: ">=0.188", optional: false}
    - {name: "binutils-devel", version_constraint: ">=2.43", optional: false}
    - {name: "binutils", version_constraint: ">=2.43", optional: false}
    - {name: "gdb", version_constraint: ">=14.2", optional: false}
    - {name: "gcc-gnat", version_constraint: ">=14.2", optional: false}
    - {name: "libgnat", version_constraint: ">=14.2", optional: false}
    - {name: "gcc-gdc", version_constraint: ">=14.2", optional: false}
    - {name: "libgphobos-static", version_constraint: ">=14.2", optional: false}
    - {name: "python3-devel", version_constraint: ">=3.11", optional: false}
    - {name: "python3", version_constraint: ">=3.11", optional: false}
    - {name: "python3-sphinx", version_constraint: ">=5.3", optional: false}
    - {name: "python-sphinx", version_constraint: ">=5.3", optional: false}
    - {name: "hostname", version_constraint: null, optional: false}
    - {name: "procps", version_constraint: null, optional: false}
    - {name: "doxygen", version_constraint: ">=1.8", optional: false}
    - {name: "graphviz", version_constraint: null, optional: false}
    - {name: "dblatex", version_constraint: null, optional: false}
    - {name: "texlive-collection-latex", version_constraint: null, optional: false}
    - {name: "docbook5-style-xsl", version_constraint: null, optional: false}
    - {name: "llvm", version_constraint: ">=15", optional: false}
    - {name: "lld", version_constraint: ">=15", optional: false}
    - {name: "annobin-plugin-gcc", version_constraint: ">=10.62", optional: false}
    - {name: "rpm-devel", version_constraint: null, optional: false}
    - {name: "glibc-devel", version_constraint: ">=2.38", optional: false}
    - {name: "glibc-static", version_constraint: ">=2.38", optional: false}
    - {name: "glibc", version_constraint: ">=2.38", optional: false}
    - {name: "tzdata", version_constraint: ">=2024a", optional: false}
  runtime_dependencies:
    - {name: "glibc", version_constraint: null, optional: false}
    - {name: "binutils", version_constraint: null, optional: false}

  optional_dependencies: []
  conflicts: []

build:
  build_system: Make
  build_commands:
    - "mkdir -p build && cd build && ../configure --prefix=/usr --enable-languages=c,c++ --disable-multilib --with-build-sysroot=/"
    - "cd build && make -j$(nproc)"
  build_dependencies:
    - "gcc"
    - "gcc-c++"
    - "make"
    - "gawk"
    - "bison"
    - "flex"
    - "texinfo"
    - "texinfo-tex"
    - "gettext"
    - "zlib-devel"
    - "gmp-devel"
    - "mpfr-devel"
    - "libmpc-devel"
    - "libzstd-devel"
    - "libunwind-devel"
    - "systemtap-sdt-devel"
    - "elfutils-devel"
    - "elfutils-libelf-devel"
    - "binutils-devel"
    - "binutils"
    - "gdb"
    - "gcc-gnat"
    - "libgnat"
    - "gcc-gdc"
    - "libgphobos-static"
    - "python3-devel"
    - "python3"
    - "python3-sphinx"
    - "python-sphinx"
    - "hostname"
    - "procps"
    - "doxygen"
    - "graphviz"
    - "dblatex"
    - "texlive-collection-latex"
    - "docbook5-style-xsl"
    - "llvm"
    - "lld"
    - "annobin-plugin-gcc"
    - "rpm-devel"
    - "glibc-devel"
    - "glibc-static"
    - "glibc"
    - "tzdata"
  build_flags: []
  environment:
    CFLAGS: "-O2"
    CXXFLAGS: "-O2"
  working_directory: null
  target_architectures: [X86_64v1, X86_64v3, Aarch64]
  cross_compiler_prefix: null
  target_sysroot: null

install:
  install_method: RunCommands
  install_commands:
    - |
      locate_gcc_src() {
        if [ -f configure ] && [ -d contrib ]; then
          pwd
          return 0
        fi
        CANDIDATE=$(find . -maxdepth 1 -mindepth 1 -type d -name 'gcc-*' | head -1)
        if [ -n "$CANDIDATE" ] && [ -f "$CANDIDATE/configure" ]; then
          (cd "$CANDIDATE" && pwd)
          return 0
        fi
        return 1
      }
      GCC_DIR=$(locate_gcc_src) || {
        echo "Unable to locate extracted GCC sources during install" >&2
        exit 1
      }
      cd "$GCC_DIR/build" && make install DESTDIR=$DESTDIR
    - "mkdir -p $DESTDIR/usr/lib/gcc"
    - "ldconfig -r $DESTDIR || true"
  install_directories: ["/usr/bin", "/usr/lib", "/usr/lib64", "/usr/include", "/usr/share"]
  install_files: []
  post_install_commands:
    - "echo 'GCC installed successfully'"
    - "echo 'Creating gcc symlinks...'"

files:
  include_patterns: ["**/*.c", "**/*.h", "**/*.cpp", "configure"]
  exclude_patterns: ["**/*.o", "build/**/*.o", "**/tests/**"]
  binary_files:
    - "usr/bin/gcc"
    - "usr/bin/g++"
    - "usr/bin/cpp"
    - "usr/lib/libgcc_s.so*"
    - "usr/lib64/libgcc_s.so*"
    - "usr/lib/libstdc++.so*"
    - "usr/lib64/libstdc++.so*"
  config_files: []
  documentation_files: []
  license_files: ["COPYING", "COPYING3", "COPYING.LIB", "COPYING.RUNTIME"]

scripts:
  pre_install: "echo 'Installing GCC (GNU Compiler Collection)...'"
  post_install: |
    echo "GCC installed successfully"
    echo "C and C++ compilers are now available"
  pre_uninstall: null
  post_uninstall: null
  pre_upgrade: null
  post_upgrade: null

metadata:
  maintainer: "Oreon Project Team <packaging@oreonproject.org>"
  section: "devel"
  priority: "optional"
  provides: ["gcc", "g++", "cpp", "libgcc", "libgcc_s", "libstdc++"]
  conflicts: []

