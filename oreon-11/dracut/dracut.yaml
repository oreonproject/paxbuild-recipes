name: dracut
version: "109"
description: "Initramfs generator using udev"
author: "dracut-ng team"
license: "GPL-2.0-or-later AND LGPL-2.1-or-later AND GPL-2.0-only"
homepage: "https://github.com/dracut-ng/dracut-ng"
repository: "https://github.com/dracut-ng/dracut-ng"
source_url: "https://github.com/dracutdevs/dracut/archive/refs/tags/061.tar.gz"
keywords:
  - dracut
  - initramfs
  - boot
categories:
  - system

dependencies:
  build_dependencies:
    - {name: "gcc", version_constraint: ">=11", optional: false}
    - {name: "make", version_constraint: ">=4.3", optional: false}
    - {name: "bash", version_constraint: ">=5.0", optional: false}
    - {name: "pkgconf", version_constraint: ">=1.7", optional: false}
    - {name: "kmod-devel", version_constraint: ">=23", optional: false}
    - {name: "systemd", version_constraint: ">=254", optional: false}
    - {name: "bash-completion", version_constraint: ">=2.11", optional: false}
    - {name: "cargo", version_constraint: ">=1.74", optional: false}
    - {name: "openssl-devel", version_constraint: ">=3.0", optional: false}
    - {name: "git-core", version_constraint: ">=2.39", optional: false}
    - {name: "docbook-style-xsl", version_constraint: null, optional: false}
    - {name: "docbook-dtds", version_constraint: null, optional: false}
    - {name: "libxslt", version_constraint: ">=1.1", optional: false}
    - {name: "asciidoctor", version_constraint: ">=2.0", optional: false}
  runtime_dependencies:
    - {name: "glibc", version_constraint: null, optional: false}
    - {name: "bash", version_constraint: null, optional: false}
    - {name: "coreutils", version_constraint: null, optional: false}
    - {name: "util-linux", version_constraint: null, optional: false}
    - {name: "e2fsprogs", version_constraint: null, optional: false}
    - {name: "kmod", version_constraint: null, optional: false}

  optional_dependencies:
    - name: "memstrack"
      version_constraint: ">=0.1"
      optional: true
    - name: "hardlink"
      version_constraint: ">=1.0"
      optional: true
    - name: "kpartx"
      version_constraint: ">=0.1"
      optional: true
    - name: "tpm2-tools"
      version_constraint: ">=4.0"
      optional: true
  conflicts: []

build:
  build_system: Make
  build_commands:
    - "./configure --prefix=/usr --sysconfdir=/etc --libdir=/usr/lib --enable-dracut-cpio"
    - "make -j$(nproc) -k || true"
    - "test -f src/dracut/dracut || test -f dracut || echo 'Warning: dracut binary location may vary'"
  build_dependencies:
    - "gcc"
    - "make"
    - "bash"
    - "pkgconf"
    - "kmod-devel"
    - "systemd"
    - "cargo"
    - "openssl-devel"
    - "git-core"
    - "bash-completion"
    - "docbook-style-xsl"
    - "docbook-dtds"
    - "libxslt"
    - "asciidoctor"
  build_flags: []
  environment:
    CFLAGS: "-O2"
    PKG_CONFIG_PATH: "/usr/lib/pkgconfig:/usr/share/pkgconfig"
  working_directory: null
  target_architectures:
    - X86_64v1
    - X86_64v3
    - Aarch64
  cross_compiler_prefix: null
  target_sysroot: null

install:
  install_method: RunCommands
  install_commands:
    - "make install DESTDIR=$DESTDIR"
    - "mkdir -p $DESTDIR/boot/dracut"
    - "mkdir -p $DESTDIR/var/lib/dracut/overlay"
    - "mkdir -p $DESTDIR/var/log"
    - "touch $DESTDIR/var/log/dracut.log"
    - "mkdir -p $DESTDIR/usr/lib/dracut/dracut.conf.d"
    - "echo 'DRACUT_VERSION=109' > $DESTDIR/usr/lib/dracut/dracut-version.sh"
    - "rm -rf $DESTDIR/usr/lib/dracut/modules.d/10dash"
    - "rm -rf $DESTDIR/usr/lib/dracut/modules.d/00mksh"
    - "rm -rf $DESTDIR/usr/lib/dracut/modules.d/35network-legacy"
  install_directories: []
  install_files: []
  post_install_commands:
    - 'echo "hostonly=\"no\"" > $DESTDIR/usr/lib/dracut/dracut.conf.d/02-generic-image.conf'
    - 'echo "add_dracutmodules+=\" dmsquash-live livenet \"" > $DESTDIR/usr/lib/dracut/dracut.conf.d/03-live.conf'

files:
  include_patterns:
    - "usr/bin/dracut"
    - "usr/bin/lsinitrd"
    - "usr/bin/dracut-catimages"
    - "usr/lib/dracut/**/*"
    - "usr/share/bash-completion/completions/dracut"
    - "usr/share/bash-completion/completions/lsinitrd"
    - "etc/dracut.conf"
    - "etc/dracut.conf.d/**/*"
    - "boot/dracut/**/*"
    - "var/lib/dracut/**/*"
    - "usr/lib/systemd/system/dracut-*.service"
    - "usr/lib/kernel/install.d/*.install"
  exclude_patterns:
    - "**/*.o"
    - "**/*.a"
    - ".git/**/*"
  binary_files:
    - "usr/lib/dracut/dracut-install"
    - "usr/lib/dracut/dracut-util"
    - "usr/lib/dracut/skipcpio"
    - "usr/lib/dracut/dracut-cpio"
  config_files:
    - "etc/dracut.conf"
  documentation_files: []
  license_files: []

scripts:
  pre_install: |
    echo "Installing dracut..."
  post_install: |
    echo "dracut installed successfully"
    echo "To create a live ISO initramfs, use: dracut --add dmsquash-live --add livenet"
  pre_uninstall: |
    echo "Removing dracut..."
  post_uninstall: |
    echo "dracut removed successfully"
  pre_upgrade: null
  post_upgrade: null

metadata:
  maintainer: "Oreon Project Team <packaging@oreonproject.org>"
  section: "system"
  priority: "optional"
  provides:
    - "dracut"
    - "initramfs-generator"
  conflicts: []
